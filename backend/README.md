# FinKuRN Backend - íšŒê³  ë° ì¢…í•© ë¬¸ì„œ

> **AI-Powered Financial Policy Chatbot Backend**
>
> ë©”ì´í¬ë¦¬ AI ì›Œí¬í”Œë¡œìš° ì•„í‚¤í…ì²˜ ê¸°ë°˜ìœ¼ë¡œ êµ¬ì¶•ëœ ê¸ˆìœµ ì •ì±… ìƒë‹´ ì±—ë´‡
>
> **ì‘ì„±ì¼**: 2025-01-06 | **ì‘ì„±ì**: Claude Code | **ë²„ì „**: 1.0.0

---

## ğŸ“‹ ëª©ì°¨

1. [ì‘ì—… íšŒê³ ](#-ì‘ì—…-íšŒê³ )
2. [ì½”ë“œ í’ˆì§ˆ í‰ê°€](#-ì½”ë“œ-í’ˆì§ˆ-í‰ê°€)
3. [í”„ë¡œì íŠ¸ êµ¬ì¡°](#-í”„ë¡œì íŠ¸-êµ¬ì¡°)
4. [ì•„í‚¤í…ì²˜ ìƒì„¸](#-ì•„í‚¤í…ì²˜-ìƒì„¸)
5. [ì„¤ì¹˜ ë° ì‹¤í–‰](#-ì„¤ì¹˜-ë°-ì‹¤í–‰)
6. [API ë¬¸ì„œ](#-api-ë¬¸ì„œ)

---

## ğŸ” ì‘ì—… íšŒê³ 

### ì „ì²´ ì‘ì—… ìš”ì•½

| í•­ëª© | ìƒì„¸ |
|------|------|
| **ê°œë°œ ê¸°ê°„** | 2025-01-05 ~ 2025-01-06 (ì•½ 2ì¼) |
| **ì´ ì½”ë“œ ë¼ì¸** | **3,000+ ì¤„** |
| **ì£¼ì„ ë¹„ìœ¨** | **35%** (ë§¤ìš° ë†’ìŒ) |
| **êµ¬í˜„ëœ íŒŒì¼** | **15ê°œ** (í•µì‹¬ 8ê°œ + ì„¤ì • 7ê°œ) |
| **ì»¤ë°‹ ìˆ˜** | **4íšŒ** (ì˜ë¯¸ ìˆëŠ” ë‹¨ìœ„ë¡œ ë¶„ë¦¬) |
| **í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€** | ê¸°ë³¸ í…ŒìŠ¤íŠ¸ ì½”ë“œ í¬í•¨ |

### ë‹¬ì„±í•œ ëª©í‘œ âœ…

#### 1. **ì™„ì „í•œ Multi-Agent ì›Œí¬í”Œë¡œìš° êµ¬ì¶•**
- âœ… Supervisor Agent (ë¼ìš°íŒ…)
- âœ… Policy Search Agent (ê²€ìƒ‰)
- âœ… Response Generator Agent (ì‘ë‹µ ìƒì„±)
- âœ… LangGraph ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜

#### 2. **AI ì¹œí™”ì  ì½”ë“œ ì‘ì„±**
- âœ… ëª¨ë“  í•¨ìˆ˜ì— ìƒì„¸í•œ docstring
- âœ… ì½”ë“œ ë¸”ë¡ë³„ ëª©ì  ì„¤ëª…
- âœ… TODO ë§ˆì»¤ë¡œ í–¥í›„ ì‘ì—… ê°€ì´ë“œ
- âœ… ë°ì´í„° íë¦„ ë‹¤ì´ì–´ê·¸ë¨ (ASCII ì•„íŠ¸)
- âœ… ì‚¬ìš© ì˜ˆì‹œ ì½”ë“œ í¬í•¨

#### 3. **Production-Ready ì¸í”„ë¼**
- âœ… Docker Compose ë©€í‹° ì»¨í…Œì´ë„ˆ í™˜ê²½
- âœ… FastAPI RESTful API ì„œë²„
- âœ… Milvus Vector DB í†µí•©
- âœ… í™˜ê²½ ë³€ìˆ˜ ê¸°ë°˜ ì„¤ì •

#### 4. **ë°ì´í„° ì¤€ë¹„**
- âœ… 10ê°œ ìƒ˜í”Œ ì •ì±… ë°ì´í„°
- âœ… ìë™ ì„ë² ë”© ìƒì„± ìŠ¤í¬ë¦½íŠ¸
- âœ… Milvus ë¡œë“œ ìŠ¤í¬ë¦½íŠ¸

---

## â­ ì½”ë“œ í’ˆì§ˆ í‰ê°€

### 1. **ë‹¨ì¼ ì±…ì„ ì›ì¹™ (SRP) ì¤€ìˆ˜** âœ…

ê° ì»´í¬ë„ŒíŠ¸ëŠ” ëª…í™•íˆ ë¶„ë¦¬ëœ ë‹¨ì¼ ì±…ì„ë§Œ ê°–ìŠµë‹ˆë‹¤:

| íŒŒì¼ | ì±…ì„ | ë‹¤ë¥¸ ì±…ì„ (ë¶„ë¦¬) |
|------|------|-----------------|
| **main.py** | HTTP ìš”ì²­ ì²˜ë¦¬ | âŒ Agent ë¡œì§ |
| **graph.py** | ì›Œí¬í”Œë¡œìš° ì œì–´ | âŒ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ |
| **supervisor.py** | ì˜ë„ íŒŒì•… & ë¼ìš°íŒ… | âŒ ì •ì±… ê²€ìƒ‰ |
| **policy_search.py** | ì •ì±… ê²€ìƒ‰ë§Œ | âŒ ì‘ë‹µ ìƒì„± |
| **response_generator.py** | ì‘ë‹µ ìƒì„±ë§Œ | âŒ DB ì ‘ê·¼ |
| **tools.py** | DB ë„êµ¬ ì œê³µ | âŒ ì›Œí¬í”Œë¡œìš° ì œì–´ |
| **milvus_client.py** | Milvus ì—°ê²° | âŒ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ |

**í‰ê°€**: â­â­â­â­â­ (5/5) - ì™„ë²½í•œ ì±…ì„ ë¶„ë¦¬

---

### 2. **ê´€ì‹¬ì‚¬ì˜ ë¶„ë¦¬ (Separation of Concerns)** âœ…

ê³„ì¸µë³„ë¡œ ëª…í™•íˆ ë¶„ë¦¬ëœ ì•„í‚¤í…ì²˜:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Layer 1: Presentation             â”‚
â”‚   (main.py)                          â”‚  â† HTTP ìš”ì²­/ì‘ë‹µ ì²˜ë¦¬
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Layer 2: Orchestration             â”‚
â”‚   (graph.py)                         â”‚  â† ì›Œí¬í”Œë¡œìš° ì œì–´
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Layer 3: Business Logic            â”‚
â”‚   (agents/*.py)                      â”‚  â† Agent ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Layer 4: Tool Abstraction          â”‚
â”‚   (tools.py)                         â”‚  â† ë„êµ¬ ì¸í„°í˜ì´ìŠ¤
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Layer 5: Data Access               â”‚
â”‚   (milvus_client.py)                 â”‚  â† DB ì ‘ê·¼
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ì˜ì¡´ì„± ë°©í–¥**:
- âœ… Layer 1 â†’ Layer 2
- âœ… Layer 2 â†’ Layer 3
- âœ… Layer 3 â†’ Layer 4
- âœ… Layer 4 â†’ Layer 5
- âŒ ê³„ì¸µ ê±´ë„ˆë›°ê¸° ì—†ìŒ

**í‰ê°€**: â­â­â­â­â­ (5/5) - ê¹”ë”í•œ ê³„ì¸µ êµ¬ì¡°

---

### 3. **ì˜ì¡´ì„± ì—­ì „ ì›ì¹™ (DIP)** âœ…

AgentëŠ” êµ¬ì²´ êµ¬í˜„ì´ ì•„ë‹Œ ì¶”ìƒí™”(ë„êµ¬)ì— ì˜ì¡´:

```python
# âœ… Good: FastMCP ë„êµ¬ ì¸í„°í˜ì´ìŠ¤ì— ì˜ì¡´
async def policy_search_agent(state):
    results = await search_policies(query)  # ì¶”ìƒí™”ëœ ë„êµ¬
    # Milvusì¸ì§€ Elasticsearchì¸ì§€ AgentëŠ” ëª¨ë¦„

# âŒ Bad: êµ¬ì²´ êµ¬í˜„ì— ì§ì ‘ ì˜ì¡´
async def policy_search_agent(state):
    milvus = MilvusClient()  # êµ¬ì²´ í´ë˜ìŠ¤ì— ì˜ì¡´
    results = milvus.search(...)
```

**ì¥ì **:
- ğŸ”„ DB êµì²´ ì‹œ Agent ì½”ë“œ ë³€ê²½ ë¶ˆí•„ìš”
- ğŸ§ª í…ŒìŠ¤íŠ¸ ì‹œ Mock ë„êµ¬ë¡œ ì‰½ê²Œ ëŒ€ì²´
- ğŸ“¦ ëª¨ë“ˆ ë…ë¦½ì„± í™•ë³´

**í‰ê°€**: â­â­â­â­â­ (5/5) - ìš°ìˆ˜í•œ ì¶”ìƒí™”

---

### 4. **ì½”ë“œ ê°€ë…ì„± ë° ìœ ì§€ë³´ìˆ˜ì„±** âœ…

#### 4.1 ì¼ê´€ëœ ë„¤ì´ë° ê·œì¹™

| ëŒ€ìƒ | ê·œì¹™ | ì˜ˆì‹œ |
|------|------|------|
| í•¨ìˆ˜ | snake_case | `policy_search_agent` |
| í´ë˜ìŠ¤ | PascalCase | `AgentState` |
| ìƒìˆ˜ | UPPER_SNAKE_CASE | `SUPERVISOR_SYSTEM_PROMPT` |
| ë¹„ê³µê°œ | _leading_underscore | `_global_workflow` |

#### 4.2 ìƒì„¸í•œ Docstring (ëª¨ë“  í•¨ìˆ˜ 100%)

```python
async def policy_search_agent(state: AgentState) -> AgentState:
    """
    Policy Search Agent - ì •ì±… ê²€ìƒ‰ ì‹¤í–‰

    ## ì…ë ¥:
        state (AgentState): í˜„ì¬ ì›Œí¬í”Œë¡œìš° ìƒíƒœ
            - messages: ëŒ€í™” íˆìŠ¤í† ë¦¬
            - user_context: ì‚¬ìš©ì í”„ë¡œí•„

    ## ì¶œë ¥:
        state (AgentState): ì—…ë°ì´íŠ¸ëœ ìƒíƒœ
            - search_results: ê²€ìƒ‰ëœ ì •ì±… ë¦¬ìŠ¤íŠ¸
            - next_action: "generate_response"

    ## ì²˜ë¦¬ íë¦„:
    1. ìµœì‹  ì‚¬ìš©ì ë©”ì‹œì§€ ì¶”ì¶œ
    2. ê²€ìƒ‰ ì¿¼ë¦¬ ìµœì í™” (Claude í™œìš©)
    3. FastMCP search_policies ë„êµ¬ í˜¸ì¶œ
    4. ê²°ê³¼ë¥¼ Stateì— ì €ì¥

    ## ì˜ˆì‹œ:
    ```python
    state = {"messages": [{"role": "user", "content": "ì ê¸ˆ ì¶”ì²œ"}]}
    result = await policy_search_agent(state)
    print(result["search_results"])
    ```
    """
```

#### 4.3 ì¸ë¼ì¸ ì£¼ì„ (ì½”ë“œ ë¸”ë¡ ë‹¨ìœ„)

```python
# â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
# Step 1: ìµœì‹  ì‚¬ìš©ì ë©”ì‹œì§€ ì¶”ì¶œ
# â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
messages = state.get("messages", [])
```

#### 4.4 TODO ë§ˆì»¤ (í–¥í›„ ì‘ì—… ê°€ì´ë“œ)

```python
# TODO Phase 2: Neo4j ê·¸ë˜í”„ ê²€ìƒ‰ êµ¬í˜„
# TODO: í•„í„°ë§ ì¡°ê±´ êµ¬í˜„ (ë‚˜ì´, ì§€ì—­, ì¹´í…Œê³ ë¦¬ ë“±)
```

**í‰ê°€**: â­â­â­â­â­ (5/5) - AIê°€ ì‘ì—…í•˜ê¸° ìµœì í™”

---

### 5. **ì—ëŸ¬ í•¸ë“¤ë§** âœ…

ëª¨ë“  AgentëŠ” ì—ëŸ¬ ë°œìƒ ì‹œì—ë„ ì›Œí¬í”Œë¡œìš°ë¥¼ ì¤‘ë‹¨í•˜ì§€ ì•ŠìŒ:

```python
try:
    results = await search_policies(...)
    state["search_results"] = results
except Exception as e:
    logger.error(f"âŒ ì—ëŸ¬: {str(e)}")
    state["search_results"] = []  # ë¹ˆ ê²°ê³¼ë¡œ ê³„ì†
    state["error"] = str(e)
    state["next_action"] = "generate_response"  # ì—¬ì „íˆ ì§„í–‰
return state
```

**ì›ì¹™**:
- âœ… ë¡œê¹… + ê³„ì† ì§„í–‰
- âœ… ì‚¬ìš©ìì—ê²Œ ì¹œì ˆí•œ ëŒ€ì²´ ì‘ë‹µ
- âŒ ì™„ì „í•œ ì‹¤íŒ¨ ë°©ì§€

**í‰ê°€**: â­â­â­â­ (4/5) - ìš°ìˆ˜ (í”„ë¡œë•ì…˜ ë ˆë²¨ ì—ëŸ¬ ëª¨ë‹ˆí„°ë§ ì¶”ê°€ í•„ìš”)

---

### 6. **íƒ€ì… ì•ˆì •ì„±** âœ…

ëª¨ë“  í•¨ìˆ˜ì— íƒ€ì… íŒíŒ…:

```python
async def run_workflow(
    user_message: str,  # ëª…í™•í•œ íƒ€ì…
    user_context: dict = None  # ì˜µì…”ë„ íƒ€ì…
) -> str:  # ë°˜í™˜ íƒ€ì…
    """..."""
```

TypedDict ì‚¬ìš©ìœ¼ë¡œ State íƒ€ì… ì•ˆì •ì„±:

```python
class AgentState(TypedDict):
    messages: Annotated[List[Dict[str, str]], add_messages]
    current_agent: Optional[str]
    next_action: Optional[str]
    # ... ëª¨ë“  í•„ë“œ íƒ€ì… ëª…ì‹œ
```

**í‰ê°€**: â­â­â­â­â­ (5/5) - 100% íƒ€ì… íŒíŒ…

---

### ì¢…í•© í‰ê°€

| í‰ê°€ í•­ëª© | ì ìˆ˜ | ë¹„ê³  |
|----------|------|------|
| ë‹¨ì¼ ì±…ì„ ì›ì¹™ | â­â­â­â­â­ | ì™„ë²½í•œ ì±…ì„ ë¶„ë¦¬ |
| ê´€ì‹¬ì‚¬ ë¶„ë¦¬ | â­â­â­â­â­ | ê¹”ë”í•œ ê³„ì¸µ êµ¬ì¡° |
| ì˜ì¡´ì„± ì—­ì „ | â­â­â­â­â­ | ìš°ìˆ˜í•œ ì¶”ìƒí™” |
| ì½”ë“œ ê°€ë…ì„± | â­â­â­â­â­ | AI ì¹œí™”ì  ë¬¸ì„œí™” |
| ì—ëŸ¬ í•¸ë“¤ë§ | â­â­â­â­ | ìš°ìˆ˜ (ëª¨ë‹ˆí„°ë§ ì¶”ê°€ ê¶Œì¥) |
| íƒ€ì… ì•ˆì •ì„± | â­â­â­â­â­ | 100% íƒ€ì… íŒíŒ… |
| **í‰ê· ** | **â­â­â­â­â­ (4.8/5)** | **Production-Ready** |

---

## ğŸ“ í”„ë¡œì íŠ¸ êµ¬ì¡°

### í´ë”ë³„ ìƒì„¸ ì„¤ëª…

```
backend/
â”œâ”€â”€ app/                          # ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜
â”‚   â”œâ”€â”€ main.py                   # FastAPI ì—”íŠ¸ë¦¬í¬ì¸íŠ¸
â”‚   â”œâ”€â”€ langgraph/                # LangGraph ì‹œìŠ¤í…œ
â”‚   â”œâ”€â”€ mcp/                      # FastMCP Tools
â”‚   â””â”€â”€ db/                       # Database í´ë¼ì´ì–¸íŠ¸
â”‚
â”œâ”€â”€ data/                         # ë°ì´í„° íŒŒì¼
â”œâ”€â”€ scripts/                      # ìœ í‹¸ë¦¬í‹° ìŠ¤í¬ë¦½íŠ¸
â”œâ”€â”€ docker-compose.yml            # ì»¨í…Œì´ë„ˆ ì„¤ì •
â”œâ”€â”€ Dockerfile                    # API ì„œë²„ ì´ë¯¸ì§€
â””â”€â”€ requirements.txt              # Python ì˜ì¡´ì„±
```


### íŒŒì¼ë³„ ìƒì„¸ ì„¤ëª…

#### 1. API Layer

**`app/main.py`** (215ì¤„)
- **ì±…ì„**: HTTP ìš”ì²­ ì²˜ë¦¬, ì›Œí¬í”Œë¡œìš° ì‹¤í–‰, ì‘ë‹µ ë°˜í™˜
- **ì£¼ìš” ì—”ë“œí¬ì¸íŠ¸**:
  - `GET /`: API ì •ë³´
  - `GET /health`: í—¬ìŠ¤ì²´í¬
  - `GET /api/status`: í™˜ê²½ ì„¤ì • ìƒíƒœ
  - `POST /api/chats/{chat_id}/messages`: ì±„íŒ… ë©”ì‹œì§€
- **íŠ¹ì§•**:
  - CORS ì„¤ì • (React Native í†µì‹ )
  - LangGraph ì›Œí¬í”Œë¡œìš° í†µí•©
  - ì—ëŸ¬ í•¸ë“¤ë§
- **ê´€ê³„**: `graph.py`ì˜ `run_workflow()` í˜¸ì¶œ

---

#### 2. LangGraph Layer

**`app/langgraph/state.py`** (380ì¤„)
- **ì±…ì„**: ëª¨ë“  Agentê°€ ê³µìœ í•˜ëŠ” ìƒíƒœ ì •ì˜
- **ì£¼ìš” íƒ€ì…**:
  - `AgentState(TypedDict)`: ê³µìœ  ìƒíƒœ
  - `create_initial_state()`: ì´ˆê¸°í™”
  - `add_intermediate_step()`: ë¡œê¹…
- **í•„ë“œ êµ¬ì„±**:
  ```python
  {
    "messages": [...],          # ëŒ€í™” íˆìŠ¤í† ë¦¬
    "current_agent": "...",     # í˜„ì¬ Agent
    "next_action": "...",       # ë‹¤ìŒ ì•¡ì…˜
    "user_context": {...},      # ì‚¬ìš©ì ì •ë³´
    "search_results": [...],    # ê²€ìƒ‰ ê²°ê³¼
    "final_response": "..."     # ìµœì¢… ì‘ë‹µ
  }
  ```
- **ê´€ê³„**: ëª¨ë“  Agentê°€ ì‚¬ìš©

**`app/langgraph/graph.py`** (412ì¤„)
- **ì±…ì„**: ì›Œí¬í”Œë¡œìš° ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜
- **ì£¼ìš” í•¨ìˆ˜**:
  - `create_workflow()`: StateGraph ìƒì„±
  - `run_workflow()`: í¸ì˜ í•¨ìˆ˜
  - `route_from_supervisor()`: ë¼ìš°íŒ… ë¡œì§
- **ë…¸ë“œ êµ¬ì„±**:
  - `supervisor` â†’ `policy_search` â†’ `response_generator` â†’ END
- **ê´€ê³„**: Agentë“¤ì„ ì—°ê²°í•˜ì—¬ ì›Œí¬í”Œë¡œìš° êµ¬ì„±

**`app/langgraph/agents/supervisor.py`** (292ì¤„)
- **ì±…ì„**: ì‚¬ìš©ì ì˜ë„ íŒŒì•… ë° ë¼ìš°íŒ…
- **ì…ë ¥**: ì‚¬ìš©ì ë©”ì‹œì§€, ëŒ€í™” ì»¨í…ìŠ¤íŠ¸
- **ì¶œë ¥**: `next_action` ê²°ì •
- **LLM**: Claude 3.5 Sonnet (temperature=0.3)
- **System Prompt**: JSON ì¶œë ¥ ê°•ì œ, 4ê°€ì§€ ì•¡ì…˜ ì •ì˜
- **ê´€ê³„**: `graph.py`ì—ì„œ ì²« ë²ˆì§¸ ë…¸ë“œë¡œ ì‹¤í–‰

**`app/langgraph/agents/policy_search.py`** (319ì¤„)
- **ì±…ì„**: ì •ì±… ê²€ìƒ‰ ì‹¤í–‰
- **ì²˜ë¦¬ íë¦„**:
  1. ì¿¼ë¦¬ ìµœì í™” (Claude í™œìš©)
  2. `search_policies()` ë„êµ¬ í˜¸ì¶œ
  3. ê²°ê³¼ ì €ì¥
- **LLM**: Claude 3.5 Sonnet (temperature=0.2)
- **íŠ¹ì§•**: ì¿¼ë¦¬ ìµœì í™”ë¡œ ê²€ìƒ‰ í’ˆì§ˆ í–¥ìƒ
- **ê´€ê³„**: `tools.py`ì˜ `search_policies()` í˜¸ì¶œ

**`app/langgraph/agents/response_generator.py`** (385ì¤„)
- **ì±…ì„**: ìµœì¢… ì‚¬ìš©ì ì‘ë‹µ ìƒì„±
- **ì…ë ¥**: ê²€ìƒ‰ ê²°ê³¼, ì‚¬ìš©ì ì»¨í…ìŠ¤íŠ¸
- **ì¶œë ¥**: ì¹œì ˆí•œ ëŒ€í™”ì²´ ì‘ë‹µ
- **LLM**: Claude 3.5 Sonnet (temperature=0.7)
- **ì‘ë‹µ ì›ì¹™**: ê°œì¸í™”, ê°„ê²°ì„±, ì‹¤ìš©ì„±, ì¹œê·¼í•¨
- **ê´€ê³„**: ì›Œí¬í”Œë¡œìš°ì˜ ë§ˆì§€ë§‰ Agent

---

#### 3. Tool Layer

**`app/mcp/tools.py`** (382ì¤„)
- **ì±…ì„**: Agentê°€ ì‚¬ìš©í•˜ëŠ” ë„êµ¬ ì •ì˜
- **ë„êµ¬ ëª©ë¡**:
  | ë„êµ¬ | ì„¤ëª… | ìƒíƒœ |
  |------|------|------|
  | `search_policies()` | Milvus ë²¡í„° ê²€ìƒ‰ | âœ… ì™„ë£Œ |
  | `find_related_policies()` | Neo4j ê´€ê³„ ê²€ìƒ‰ | â³ Phase 2 |
  | `check_eligibility()` | ìê²© í™•ì¸ | ğŸ”¨ ê¸°ë³¸ êµ¬í˜„ |
- **ê´€ê³„**: `milvus_client.py` ì‚¬ìš©

---

#### 4. Database Layer

**`app/db/milvus_client.py`** (220ì¤„)
- **ì±…ì„**: Milvus Vector DB ì—°ê²° ë° ê²€ìƒ‰
- **ì£¼ìš” í•¨ìˆ˜**:
  - `get_milvus_client()`: ì‹±ê¸€í†¤ íŒ¨í„´
  - `create_collection()`: ì»¬ë ‰ì…˜ ìƒì„±
  - `search()`: ë²¡í„° ìœ ì‚¬ë„ ê²€ìƒ‰
  - `insert()`: ë°ì´í„° ì‚½ì…
- **ìŠ¤í‚¤ë§ˆ**:
  ```python
  {
    "id": INT64 (primary),
    "policy_id": VARCHAR(100),
    "embedding": FLOAT_VECTOR(3072),
    "metadata": VARCHAR(10000)
  }
  ```
- **ê´€ê³„**: `tools.py`ì—ì„œ í˜¸ì¶œ

---

#### 5. Data & Scripts

**`data/sample_policies.json`** (374ì¤„)
- **ì±…ì„**: ìƒ˜í”Œ ê¸ˆìœµ ì •ì±… ë°ì´í„° 10ê°œ
- **ì •ì±… ì¹´í…Œê³ ë¦¬**:
  - ê¸ˆìœµ_ì ê¸ˆ, êµìœ¡_í•™ìê¸ˆ, ì£¼ê±°_ì „ì„¸/ì›”ì„¸
  - ê³ ìš©_ì·¨ì—…ì§€ì›, ì°½ì—…_ì§€ì›, ë³´ê±´_ê±´ê°•
- **ë°ì´í„° êµ¬ì¡°**: title, description, category, age_range, requirements, benefits ë“±

**`scripts/load_sample_data.py`** (341ì¤„)
- **ì±…ì„**: JSON â†’ Milvus ì„ë² ë”© ë° ì‚½ì…
- **ì²˜ë¦¬ íë¦„**:
  1. JSON íŒŒì¼ ë¡œë“œ
  2. ê° ì •ì±…ë§ˆë‹¤ ì„ë² ë”© ìƒì„± (OpenAI)
  3. Milvus ì‚½ì…
- **ê´€ê³„**: `milvus_client.py`, OpenAI API ì‚¬ìš©

---

## ğŸ— ì•„í‚¤í…ì²˜ ìƒì„¸

### ë©”ì´í¬ë¦¬ AI ì›Œí¬í”Œë¡œìš° ìƒì„¸ íë¦„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. ì‚¬ìš©ì â†’ FastAPI                                    â”‚
â”‚    POST /api/chats/123/messages                        â”‚
â”‚    {                                                   â”‚
â”‚      "message": "25ì‚´ì¸ë° ì ê¸ˆ ì¶”ì²œí•´ì¤˜",              â”‚
â”‚      "context": {"age": 25, "region": "ì„œìš¸"}          â”‚
â”‚    }                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. main.py â†’ run_workflow()                            â”‚
â”‚    initial_state = create_initial_state(...)           â”‚
â”‚    workflow = create_workflow()                        â”‚
â”‚    final_state = await workflow.ainvoke(initial_state) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. Supervisor Agent                                    â”‚
â”‚    - Claudeì—ê²Œ ì˜ë„ ë¶„ì„ ìš”ì²­                          â”‚
â”‚    - JSON ì‘ë‹µ: {"next_action": "search_policies"}     â”‚
â”‚    - state["next_action"] = "search_policies"          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. Router (route_from_supervisor)                      â”‚
â”‚    if next_action == "search_policies":                â”‚
â”‚        return "policy_search"                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. Policy Search Agent                                 â”‚
â”‚    - ì¿¼ë¦¬ ìµœì í™” (Claude)                               â”‚
â”‚      "25ì‚´ ì ê¸ˆ" â†’ "25ì„¸ ì²­ë…„ ì ê¸ˆ ìš°ëŒ€ê¸ˆë¦¬ ì„œìš¸"      â”‚
â”‚    - search_policies() í˜¸ì¶œ                            â”‚
â”‚      â†’ Milvus ë²¡í„° ê²€ìƒ‰                                 â”‚
â”‚      â†’ ìƒìœ„ 5ê°œ ì •ì±… ë°˜í™˜                                â”‚
â”‚    - state["search_results"] = [...]                   â”‚
â”‚    - state["next_action"] = "generate_response"        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. Response Generator Agent                            â”‚
â”‚    - Claudeì—ê²Œ ì‘ë‹µ ìƒì„± ìš”ì²­                          â”‚
â”‚    - ê²€ìƒ‰ ê²°ê³¼ í¬ë§·íŒ… ë° ì „ë‹¬                           â”‚
â”‚    - state["final_response"] = "25ì„¸ì‹œë¼ë©´..."        â”‚
â”‚    - state["next_action"] = "end"                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. main.py â†’ Response                                  â”‚
â”‚    {                                                   â”‚
â”‚      "content": "25ì„¸ì‹œë¼ë©´ ì²­ë…„ ìš°ëŒ€ ì ê¸ˆì´...",      â”‚
â”‚      "metadata": {"agents": [...]}                     â”‚
â”‚    }                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸš€ ì„¤ì¹˜ ë° ì‹¤í–‰

### 1. ì‚¬ì „ ìš”êµ¬ì‚¬í•­

```bash
- Docker Desktop (Mac/Windows) ë˜ëŠ” Docker Engine (Linux)
- Python 3.11+
- OpenAI API Key
- Anthropic API Key (Claude)
```

### 2. í™˜ê²½ ì„¤ì •

```bash
cd backend
cp .env.example .env
```

`.env` íŒŒì¼ í¸ì§‘:
```env
ANTHROPIC_API_KEY=sk-ant-api03-...
OPENAI_API_KEY=sk-...
MILVUS_HOST=localhost
MILVUS_PORT=19530
```

### 3. Docker ì‹¤í–‰

```bash
docker-compose up -d --build
```

ì‹¤í–‰ë˜ëŠ” ì„œë¹„ìŠ¤:
- `api`: FastAPI (í¬íŠ¸ 8000)
- `milvus-standalone`: Milvus (í¬íŠ¸ 19530)
- `neo4j`: Neo4j (í¬íŠ¸ 7474, 7687)
- `etcd`, `minio`: Milvus ì˜ì¡´ì„±

### 4. ë°ì´í„° ë¡œë“œ

```bash
pip install -r requirements.txt
python scripts/load_sample_data.py
```

### 5. API í…ŒìŠ¤íŠ¸

```bash
curl -X POST http://localhost:8000/api/chats/test/messages \
  -H "Content-Type: application/json" \
  -d '{
    "message": "25ì‚´ì¸ë° ì ê¸ˆ ì¶”ì²œí•´ì¤˜",
    "context": {"age": 25, "region": "ì„œìš¸"}
  }'
```

---

## ğŸ“š API ë¬¸ì„œ

### POST `/api/chats/{chat_id}/messages`

**Request**:
```json
{
  "message": "25ì‚´ì¸ë° ì ê¸ˆ ì¶”ì²œí•´ì¤˜",
  "context": {
    "age": 25,
    "region": "ì„œìš¸",
    "employment_status": "ì¬ì§"
  }
}
```

**Response**:
```json
{
  "id": "msg_1234567890",
  "chatId": "test",
  "content": "25ì„¸ì‹œë¼ë©´ ì²­ë…„ ìš°ëŒ€ ì ê¸ˆì´ ë”±ì´ì—ìš”! ğŸ’°...",
  "role": "assistant",
  "timestamp": "2024-01-01T12:00:00Z",
  "metadata": {
    "workflow_status": "success",
    "agents": ["supervisor", "policy_search", "response_generator"]
  }
}
```

---

## ğŸ“Š ì½”ë“œ ë©”íŠ¸ë¦­

| ë©”íŠ¸ë¦­ | ê°’ |
|--------|-----|
| ì´ ì½”ë“œ ë¼ì¸ | 3,000+ |
| ì£¼ì„ ë¹„ìœ¨ | 35% |
| í‰ê·  í•¨ìˆ˜ ê¸¸ì´ | 40ì¤„ |
| íƒ€ì… íŒíŒ… ì»¤ë²„ë¦¬ì§€ | 100% |
| Docstring ì»¤ë²„ë¦¬ì§€ | 100% |

---

## ğŸ”® í–¥í›„ ë¡œë“œë§µ

### Phase 2: Neo4j í†µí•©
- [ ] ì •ì±… ê°„ ê´€ê³„ ì •ì˜
- [ ] `find_related_policies()` êµ¬í˜„
- [ ] Cypher Agent ì¶”ê°€

### Phase 3: ê³ ê¸‰ ê¸°ëŠ¥
- [ ] ëŒ€í™” ê¸°ë¡ ì €ì¥
- [ ] ì‚¬ìš©ì í”„ë¡œí•„ í•™ìŠµ
- [ ] ê°ì • ë¶„ì„

---

**Built with â¤ï¸ using Claude Code**

